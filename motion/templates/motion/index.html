<!DOCTYPE html>
<html lang="da">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <title>Motion - Vægt</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>

<body>
  <div class="container-lg">
    <form class="mb-4">
      <div class="row g-3">
        <div class="col-auto">
          <h2>Vægt</h2>
        </div>
        <div class="col-auto">
          <label for="startdate" class="form-label">Start dato</label>
        </div>
        <div class="col-auto">
          <input type="date" class="form-control" id="startdate" name="startdate" value="{{ start_date }}" min="2018-01-01" max="2025-12-31">
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-primary">Opdater</button>
        </div>
      </div>
    </form>

    <style>
      .graph {
        height: 400px;
      }
    </style>

    <div class="row mb-4">
      <div class="col-md-6 graph">
        <canvas id="weight_div"></canvas>
      </div>
      <div class="col-md-6 graph">
        <canvas id="bmi_div"></canvas>
      </div>
    </div>
    <hr>
    <div class="row mb-4">
      <div class="col-md-6 graph" style="background-color: beige;">
        <canvas id="fat_div"></canvas>
      </div>
      <div class="col-md-6 graph" style="background-color:bisque">
        <canvas id="muscle_div"></canvas>
      </div>
    </div>

    <hr>
    
    <div class="row">
      <div class="col-md-4">
        <h4>Vægtændring</h4>
        <p>Seneste uge: <strong>{{ vagtdiff }} g</strong></p>
        <p>Forrige uge gennemsnit: <strong>{{ vagt1 }} kg</strong></p>
        <p>Denne uge gennemsnit: <strong>{{ vagt2 }} kg</strong></p>
      </div>
      <div class="col-md-4">
        <a href="{% url 'motion:save_weight' %}" class="btn btn-success">Gem vægt</a>
      </div>
      <div class="col-md-4">
        <a href="{% url 'motion:blood_pressure' %}" class="btn btn-info">Blodtryk</a>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Weight Chart
    const weight_data = {{ weight_data|safe }};
    if (weight_data.length > 0) {
      const weightCtx = document.getElementById('weight_div').getContext('2d');
      new Chart(weightCtx, {
        type: 'scatter',
        //type: 'line',
        data: {
          datasets: [{
            label: 'Vægt (kg)',
            data: weight_data,
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.5)',
            showLine: true,
            fill: false,
            tension: 0.1,
            pointRadius: 4,
            pointHoverRadius: 6,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
            },
            title: {
              display: true,
              text: 'Vægt Udvikling'
            }
          },
          scales: {
            x: {
              type: 'linear',
              position: 'bottom',
              title: {
                display: true,
                text: 'Dato'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Vægt (kg)'
              }
            }
          }
        }
      });
    }

    // BMI Chart
    const bmi_data = {{ bmi_data|safe }};
    if (bmi_data.length > 0) {
      const bmiCtx = document.getElementById('bmi_div').getContext('2d');
      new Chart(bmiCtx, {
        type: 'scatter',
        data: {
          datasets: [{
            label: 'BMI',
            data: bmi_data,
            borderColor: 'rgb(255, 159, 64)',
            backgroundColor: 'rgba(255, 159, 64, 0.5)',
            showLine: true,
            fill: false,
            tension: 0.1,
            pointRadius: 4,
            pointHoverRadius: 6,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
            },
            title: {
              display: true,
              text: 'BMI Udvikling'
            }
          },
          scales: {
            x: {
              type: 'linear',
              position: 'bottom',
              title: {
                display: true,
                text: 'Dato'
              }
            },
            y: {
              title: {
                display: true,
                text: 'BMI'
              }
            }
          }
        }
      });
    }

    // Fat Chart
    const fat_data = {{ fat_data|safe }};
    if (fat_data.length > 0) {
      const fatCtx = document.getElementById('fat_div').getContext('2d');
      new Chart(fatCtx, {
        type: 'scatter',
        data: {
          datasets: [{
            label: 'Fedtprocent (%)',
            data: fat_data,
            borderColor: 'rgb(255, 99, 132)',
            backgroundColor: 'rgba(255, 99, 132, 0.5)',
            showLine: true,
            fill: false,
            tension: 0.1,
            pointRadius: 4,
            pointHoverRadius: 6,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
            },
            title: {
              display: true,
              text: 'Fedtprocent Udvikling'
            }
          },
          scales: {
            x: {
              type: 'linear',
              position: 'bottom',
              title: {
                display: true,
                text: 'Dato'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Fedtprocent (%)'
              }
            }
          }
        }
      });
    }

    // Muscle Chart
    const muscle_data = {{ muscle_data|safe }};
    if (muscle_data.length > 0) {
      const muscleCtx = document.getElementById('muscle_div').getContext('2d');
      new Chart(muscleCtx, {
        type: 'scatter',
        data: {
          datasets: [{
            label: 'Muskelmasse (kg)',
            data: muscle_data,
            borderColor: 'rgb(54, 162, 235)',
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            showLine: true,
            fill: false,
            tension: 0.1,
            pointRadius: 4,
            pointHoverRadius: 6,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
            },
            title: {
              display: true,
              text: 'Muskelmasse Udvikling'
            }
          },
          scales: {
            x: {
              type: 'linear',
              position: 'bottom',
              title: {
                display: true,
                text: 'Dato'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Muskelmasse (kg)'
              }
            }
          }
        }
      });
    }
  </script>
</body>

</html>
